<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gazzer API Testing Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Brand Colors - Blue & Teal to match Logo */
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --secondary-color: #1abc9c;

            /* Status Colors */
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;

            /* Backgrounds */
            --light-bg: #f8fafc;
            --card-bg: rgba(255, 255, 255, 0.98);
            /* Slightly more opaque for better contrast */
            --glass-bg: rgba(255, 255, 255, 0.2);
            --glass-border: rgba(52, 152, 219, 0.15);
            /* Blue tinted border */

            /* Shadows */
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            --hover-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);

            /* Text Colors - Increased Contrast */
            --border-color: rgba(148, 163, 184, 0.4);
            --text-primary: #0f172a;
            /* Very Dark Slate */
            --text-secondary: #334155;
            /* Dark Slate */

            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #3498db 0%, #1abc9c 100%);
            /* Blue to Teal */
            --gradient-secondary: linear-gradient(135deg, #2980b9 0%, #2c3e50 100%);
            /* Dark Blue to Slate */
            --gradient-accent: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
            /* Teal Gradient */

            /* Brand Gradients for Alerts */
            --gradient-success: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            --gradient-danger: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);

            --font-family: 'Cairo', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            position: relative;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 10% 20%, rgba(52, 152, 219, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(26, 188, 156, 0.05) 0%, transparent 20%);
            pointer-events: none;
            z-index: -1;
        }

        .layout-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Premium Header */
        header {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass-border);
            padding: 1.25rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--card-shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo-icon {
            width: 64px;
            height: 64px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .logo-icon img {
            width: 50px;
            height: 50px;
            object-fit: contain;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.2rem;
        }

        .logo-text p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .examiner-info {
            text-align: right;
        }

        .examiner-info h2 {
            font-size: 1.2rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        .examiner-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            background: rgba(102, 126, 234, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            display: inline-block;
            margin-top: 0.25rem;
            font-weight: 600;
        }

        /* KPI Cards */
        .kpi-section {
            padding: 3rem 0;
        }

        .kpi-title {
            text-align: center;
            margin-bottom: 3rem;
        }

        .kpi-title h2 {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .kpi-title p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .kpi-card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .kpi-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: var(--primary-color);
        }

        .kpi-value {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .kpi-label {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Reports Section */
        .reports-section {
            padding-bottom: 5rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-actions {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.25);
        }

        .action-btn.secondary {
            background: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            box-shadow: none;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(102, 126, 234, 0.3);
        }

        /* Reports Grid */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 2rem;
        }

        .report-card {
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--glass-border);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(20px);
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .report-header {
            padding: 1.5rem;
            background: linear-gradient(to right, rgba(248, 250, 252, 0.5), rgba(255, 255, 255, 0));
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .report-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-api {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success-color);
        }

        .badge-template {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .report-body {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .report-meta {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .report-meta div {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-desc {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            line-height: 1.6;
            flex: 1;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding: 1rem;
            background: rgba(241, 245, 249, 0.5);
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .stat-name {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-top: 0.25rem;
        }

        .view-report-btn {
            display: block;
            text-align: center;
            padding: 0.8rem;
            background: var(--light-bg);
            color: var(--primary-color);
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .view-report-btn:hover {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
        }

        /* Footer */
        footer {
            background: white;
            border-top: 1px solid var(--border-color);
            padding: 4rem 0 2rem;
            margin-top: auto;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 4rem;
            margin-bottom: 3rem;
        }

        .footer-logo h3 {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .footer-logo p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            max-width: 400px;
        }

        .footer-links h4 {
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 0.75rem;
        }

        .footer-links a,
        .footer-links li {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .footer-links a:hover {
            color: var(--primary-color);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Admin Panel */
        .admin-panel {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .admin-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            border: none;
            box-shadow: var(--hover-shadow);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .admin-btn:hover {
            transform: rotate(90deg);
        }

        .admin-panel-content {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            width: 280px;
            display: none;
            animation: slideUp 0.3s ease;
        }

        .admin-panel.active .admin-panel-content {
            display: block;
        }

        @keyframes slideUp {
            from {
                transform: translateY(10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .refresh-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Status Messages & Loading */
        .status-message {
            position: fixed;
            top: 30px;
            right: 30px;
            max-width: 400px;
            color: white;
            padding: 1.25rem 1.5rem;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            z-index: 10000;
            animation: slideInDown 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: 'Cairo', sans-serif;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-success {
            background: var(--gradient-success);
        }

        .message-error {
            background: var(--gradient-danger);
        }

        .message-info {
            background: linear-gradient(135deg, var(--info-color), #2980b9);
        }

        .loading {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s infinite linear;
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 992px) {
            .footer-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .logo {
                flex-direction: column;
                gap: 1rem;
            }

            .examiner-info {
                text-align: center;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .section-actions {
                flex-direction: column;
            }

            .action-btn {
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="layout-container header-content">
            <div class="logo">
                <div class="logo-icon">
                    <img src="./Assets/Logo.png" alt="Gazzer Logo" width="75" height="75">
                </div>
                <div class="logo-text">
                    <h1>Gazzer App API Dashboard</h1>
                    <p>Enterprise-Grade Quality Assurance Monitoring</p>
                </div>
            </div>
            <div class="examiner-info">
                <h2>Hossam Mohamed</h2>
                <p>Software QA Engineer</p>
            </div>
        </div>
    </header>

    <!-- KPI Statistics -->
    <section class="kpi-section">
        <div class="layout-container">
            <div class="kpi-title">
                <h2>API Testing Overview</h2>
                <p>Real-time aggregated statistics from all discovered API reports. Template folders are automatically
                    excluded from calculations.</p>
            </div>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="kpi-value" id="total-apis">0</div>
                    <div class="kpi-label">APIs Tested</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="kpi-value" id="total-tests">0</div>
                    <div class="kpi-label">Total Test Cases</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="kpi-value" id="avg-success">0%</div>
                    <div class="kpi-label">Avg Success Rate</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">
                        <i class="fas fa-bug"></i>
                    </div>
                    <div class="kpi-value" id="total-bugs">0</div>
                    <div class="kpi-label">Total Failed Tests</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reports Section -->
    <section class="reports-section">
        <div class="layout-container">
            <div class="section-header">
                <h2>API Testing Reports</h2>
                <div class="section-actions">
                    <a href="./report_template/index.html" class="action-btn secondary" target="_blank">
                        <i class="fas fa-file-alt"></i> View Template
                    </a>
                    <button class="action-btn" id="scan-folders">
                        <i class="fas fa-sync-alt"></i> Scan for Reports
                    </button>
                </div>
            </div>

            <div class="reports-grid" id="reports-grid">
                <!-- Reports will be dynamically inserted here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="layout-container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h3>Gazzer App Company</h3>
                    <p>Enterprise-grade API testing dashboard with comprehensive reporting, monitoring, and analytics
                        capabilities for modern development teams.</p>
                    <div class="footer-links">
                        <h4>Contact Info</h4>
                        <ul>
                            <li><i class="fas fa-user"></i> Hossam Mohamed</li>
                            <li><i class="fas fa-briefcase"></i> Software QA Engineer</li>
                            <li><i class="fas fa-envelope"></i> Hossam.Abdallah@gazzerapp.com</li>
                            <li><i class="fas fa-globe"></i> Enterprise API Testing Solutions</li>
                        </ul>
                    </div>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul id="quick-links">
                        <li><a href="./report_template/index.html" target="_blank"><i class="fas fa-file-code"></i>
                                Report Template</a></li>
                        <li><a href="./about.html"><i class="fas fa-book"></i> Documentation</a></li>
                        <li><a href="#"><i class="fas fa-chart-bar"></i> Testing Methodology</a></li>
                        <li><a href="#"><i class="fas fa-question-circle"></i> Help & Support</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#"><i class="fas fa-download"></i> Download Reports</a></li>
                        <li><a href="#"><i class="fas fa-cog"></i> API Configuration</a></li>
                        <li><a href="#"><i class="fas fa-history"></i> Version History</a></li>
                        <li><a href="#"><i class="fas fa-shield-alt"></i> Security & Privacy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; <span id="current-year">2024</span> Gazzer API Testing Dashboard. All rights reserved. |
                    Designed for Quality Assurance Excellence</p>
            </div>
        </div>
    </footer>

    <!-- Admin Panel -->
    <div class="admin-panel" id="admin-panel">
        <button class="admin-btn" id="admin-toggle">
            <i class="fas fa-cog"></i>
        </button>
        <div class="admin-panel-content">
            <h4>Dashboard Controls</h4>
            <button class="refresh-btn" id="refresh-all">
                <i class="fas fa-redo"></i> Refresh All
            </button>
            <button class="refresh-btn" id="clear-cache">
                <i class="fas fa-trash"></i> Clear Cache
            </button>
            <div
                style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 15px; text-align: center; padding-top: 10px; border-top: 1px solid var(--border);">
                <i class="fas fa-chart-pie"></i> Reports: <span id="reports-count" style="font-weight: 900;">0</span>
            </div>
        </div>
    </div>

    <!-- Keep all existing JavaScript intact -->
    <script>
        // ============================
        // DASHBOARD CORE
        // ============================
        class DashboardCore {
            constructor() {
                this.reports = [];
                this.stats = {
                    totalApis: 0,
                    totalTests: 0,
                    totalBugs: 0,
                    avgSuccessRate: 0,
                    lastScan: null
                };
                this.initialized = false;
                this.knownFolders = new Set();
            }

            async initialize() {
                console.log('ðŸš€ Initializing API Testing Dashboard...');

                // Set current year
                document.getElementById('current-year').textContent = new Date().getFullYear();

                // Setup event listeners
                this.setupEventListeners();

                // Initial scan
                await this.scanForReports();

                this.initialized = true;
                console.log('âœ… Dashboard initialized successfully');
            }

            async scanForReports() {
                console.log('ðŸ” Scanning for API reports...');
                console.log('ðŸ“Œ Current working directory assumed to be:', window.location.pathname);

                this.reports = [];
                this.knownFolders.clear();

                const foundReports = [];

                // Template folder excluded as per user request
                // try {
                //    const templateReport = await this.loadReportFromFolder('report_template');
                //    ...
                // }

                // Try to discover other API folders
                const potentialFolders = [
                    'Authentication', 'Banners', 'Generic Items', 'Item Categories', 'Item Sub-Categories', 'Provinces',
                ];

                console.log('ðŸ“ Checking potential folders:', potentialFolders);

                for (const folder of potentialFolders) {
                    console.log(`\nðŸ” Checking folder: ${folder}`);
                    try {
                        const report = await this.loadReportFromFolder(folder);
                        console.log(`ðŸ“‹ Report loaded for ${folder}:`, report);

                        if (report) {
                            console.log(`ðŸ“Š Report details - isTemplate: ${report.isTemplate}, type: ${typeof report.isTemplate}`);

                            if (!report.isTemplate) {
                                foundReports.push(report);
                                this.knownFolders.add(folder);
                                console.log(`âœ… Added API report: ${report.apiName} in ${folder}`);
                            } else {
                                console.log(`â­ï¸ Skipping template report: ${report.apiName} in ${folder}`);
                            }
                        }
                    } catch (error) {
                        console.log(`âŒ Failed to load ${folder}: ${error.message}`);
                        // Silent fail for non-existent folders
                    }
                }

                this.reports = foundReports;
                this.updateStatistics();
                this.renderDashboard();

                console.log(`ðŸ“Š Scan complete: ${this.reports.length} report(s) found`);
                console.log('ðŸ“‹ Reports found:', this.reports);

                return this.reports.length;
            }

            async loadReportFromFolder(folderName) {
                console.log(`ðŸ“‚ Attempting to load report from folder: "${folderName}"`);
                return new Promise((resolve) => {
                    // Clear previous data
                    window.REPORT_DATA = undefined;
                    const script = document.createElement('script');
                    script.src = `./${folderName}/report-data.js?t=${new Date().getTime()}`;
                    script.onload = () => {
                        try {
                            const REPORT_DATA = window.REPORT_DATA;
                            if (!REPORT_DATA) {
                                console.error(`âŒ No REPORT_DATA found in ${folderName}`);
                                if (script.parentNode) document.head.removeChild(script);
                                resolve(null);
                                return;
                            }
                            const totalTests = REPORT_DATA.testCases ? REPORT_DATA.testCases.length : 0;
                            const passedTests = REPORT_DATA.testCases ? REPORT_DATA.testCases.filter(tc => tc.status === 'passed').length : 0;
                            const failedTests = REPORT_DATA.testCases ? REPORT_DATA.testCases.filter(tc => tc.status === 'failed').length : 0;
                            const skippedTests = REPORT_DATA.testCases ? REPORT_DATA.testCases.filter(tc => tc.status === 'skipped').length : 0;
                            const criticalBugs = REPORT_DATA.testCases ? REPORT_DATA.testCases.filter(tc => tc.severity === 'critical' && tc.status === 'failed').length : 0;
                            const successRate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
                            const summary = {
                                apiName: REPORT_DATA.meta?.apiName || "Unnamed API",
                                folderName: folderName,
                                isTemplate: REPORT_DATA.meta?.isTemplate || false,
                                totalTests: totalTests,
                                passedTests: passedTests,
                                failedTests: failedTests,
                                skippedTests: skippedTests,
                                criticalBugs: criticalBugs,
                                successRate: successRate,
                                lastUpdated: REPORT_DATA.meta?.createdAt || new Date().toLocaleDateString(),
                                reportUrl: `./${folderName}/index.html`
                            };
                            console.log(`âœ… Successfully loaded report for ${folderName}:`, summary);
                            if (script.parentNode) document.head.removeChild(script);
                            resolve(summary);
                        } catch (error) {
                            console.error(`âŒ Error processing report data for ${folderName}:`, error);
                            if (script.parentNode) document.head.removeChild(script);
                            resolve(null);
                        }
                    };
                    script.onerror = (error) => {
                        console.warn(`âš ï¸ Failed to load script from ${folderName}`);
                        if (script.parentNode) document.head.removeChild(script);
                        resolve(null);
                    };
                    document.head.appendChild(script);
                });
            }

            updateStatistics() {
                // Filter out template reports - CRITICAL: Only count API reports
                const apiReports = this.reports.filter(report => !report.isTemplate);

                this.stats.totalApis = apiReports.length;
                this.stats.totalTests = apiReports.reduce((sum, report) => sum + report.totalTests, 0);
                this.stats.totalBugs = apiReports.reduce((sum, report) => sum + report.failedTests, 0);

                const totalSuccessRate = apiReports.reduce((sum, report) => sum + report.successRate, 0);
                this.stats.avgSuccessRate = apiReports.length > 0
                    ? Math.round(totalSuccessRate / apiReports.length)
                    : 0;

                this.stats.lastScan = new Date().toLocaleString();
            }

            renderDashboard() {
                // Update KPI statistics
                document.getElementById('total-apis').textContent = this.stats.totalApis;
                document.getElementById('total-tests').textContent = this.stats.totalTests;
                document.getElementById('avg-success').textContent = this.stats.avgSuccessRate > 0 ? `${this.stats.avgSuccessRate}%` : '0%';
                document.getElementById('total-bugs').textContent = this.stats.totalBugs;
                document.getElementById('reports-count').textContent = this.reports.length;

                // Update reports grid
                this.renderReportsGrid();

                // Update quick links
                this.updateQuickLinks();
            }

            renderReportsGrid() {
                const grid = document.getElementById('reports-grid');

                if (this.reports.length === 0) {
                    grid.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-folder-open"></i>
                            </div>
                            <h3>No Reports Found</h3>
                            <p>No API testing reports were found. Copy the template folder and populate it with test data to get started.</p>
                            <a href="./report_template/index.html" class="view-report-btn template" style="max-width: 300px; margin: 0 auto;">
                                <i class="fas fa-file-alt"></i> Use Template
                            </a>
                        </div>
                    `;
                    return;
                }

                // Separate template and API reports
                const apiReports = this.reports.filter(r => !r.isTemplate);
                const templateReport = this.reports.find(r => r.isTemplate);

                let reportsHTML = '';

                // Render API reports first
                apiReports.forEach((report, index) => {
                    reportsHTML += this.createReportCardHTML(report, index, false);
                });

                // Render template report last (if exists)
                if (templateReport) {
                    reportsHTML += this.createReportCardHTML(templateReport, apiReports.length, true);
                }

                grid.innerHTML = reportsHTML;
            }

            createReportCardHTML(report, index, isTemplate) {
                const colors = ['#3498db', '#1abc9c', '#9b59b6', '#e74c3c', '#f39c12', '#2ecc71'];
                const color = colors[index % colors.length];

                // Ensure correct relative path construction
                const reportPath = isTemplate ? './report_template/index.html' : `./${report.folderName}/index.html`;

                return `
                    <div class="report-card ${isTemplate ? 'template-report' : 'api-report'}">
                        <div class="report-header">
                            <div class="report-title">${report.apiName}</div>
                            <div class="report-badge ${isTemplate ? 'badge-template' : 'badge-api'}">
                                ${isTemplate ? 'Template' : 'API Report'}
                            </div>
                        </div>
                        <div class="report-body">
                            <div class="report-meta">
                                <div class="report-date">
                                    <i class="far fa-calendar-alt"></i>
                                    <span>${report.lastUpdated}</span>
                                </div>
                                <div class="report-folder">
                                    <i class="fas fa-folder"></i>
                                    <span>${report.folderName}/</span>
                                </div>
                            </div>
                            <p class="report-desc">
                                ${isTemplate
                        ? 'Reusable report template. Copy this folder, rename it, and populate with your API test data.'
                        : `${report.totalTests} test cases executed with ${report.successRate}% success rate.`}
                            </p>
                            ${!isTemplate ? `
                            <div class="report-stats">
                                <div class="stat-item">
                                    <div class="stat-value">${report.totalTests}</div>
                                    <div class="stat-name">Tests</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${report.successRate}%</div>
                                    <div class="stat-name">Success</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${report.failedTests}</div>
                                    <div class="stat-name">Failed</div>
                                </div>
                            </div>
                            ` : ''}
                            <a href="${reportPath}" target="_blank"
                               class="view-report-btn ${isTemplate ? 'template' : ''}">
                                <i class="fas fa-external-link-alt"></i>
                                ${isTemplate ? 'View Template' : 'View Report'}
                            </a>
                        </div>
                    </div>
                `;
            }

            updateQuickLinks() {
                const quickLinks = document.getElementById('quick-links');
                const apiReports = this.reports.filter(r => !r.isTemplate);

                if (apiReports.length > 0) {
                    const linksHTML = apiReports.map(report => `
                        <li><a href="${report.reportUrl}" target="_blank"><i class="fas fa-chart-bar"></i> ${report.apiName} Report</a></li>
                    `).join('');

                    quickLinks.innerHTML = `
                        <li><a href="./report_template/index.html" target="_blank"><i class="fas fa-file-code"></i> Report Template</a></li>
                        ${linksHTML}
                        <li><a href="./about.html"><i class="fas fa-book"></i> Documentation</a></li>
                    `;
                }
            }

            showMessage(message, type = 'info') {
                // Remove existing messages
                document.querySelectorAll('.status-message').forEach(msg => msg.remove());

                const messageEl = document.createElement('div');
                messageEl.className = `status-message message-${type}`;
                messageEl.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                            <span style="font-weight: 600;">${message}</span>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer; opacity: 0.7; transition: opacity 0.3s; padding: 5px;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

                document.body.appendChild(messageEl);

                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (messageEl.parentElement) {
                        messageEl.remove();
                    }
                }, 5000);
            }

            setupEventListeners() {
                // Scan folders button
                document.getElementById('scan-folders').addEventListener('click', async () => {
                    const btn = document.getElementById('scan-folders');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<span class="loading"></span> Scanning...';
                    btn.disabled = true;

                    try {
                        const count = await this.scanForReports();
                        this.showMessage(`Found ${count} report(s)`, 'success');
                    } catch (error) {
                        this.showMessage(`Scan failed: ${error.message}`, 'error');
                    } finally {
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }
                });

                // Admin panel toggle
                document.getElementById('admin-toggle').addEventListener('click', () => {
                    document.getElementById('admin-panel').classList.toggle('active');
                });

                // Refresh all button
                document.getElementById('refresh-all').addEventListener('click', async () => {
                    const btn = document.getElementById('refresh-all');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<span class="loading"></span> Refreshing...';

                    try {
                        await this.scanForReports();
                        this.showMessage('Dashboard refreshed successfully', 'success');
                    } catch (error) {
                        this.showMessage(`Refresh failed: ${error.message}`, 'error');
                    } finally {
                        btn.innerHTML = originalText;
                    }
                });

                // Clear cache button
                document.getElementById('clear-cache').addEventListener('click', () => {
                    localStorage.clear();
                    sessionStorage.clear();
                    this.showMessage('Cache cleared successfully', 'success');
                });

                // Close admin panel when clicking outside
                document.addEventListener('click', (event) => {
                    const adminPanel = document.getElementById('admin-panel');
                    if (!adminPanel.contains(event.target)) {
                        adminPanel.classList.remove('active');
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (event) => {
                    // Ctrl/Cmd + R to refresh
                    if ((event.ctrlKey || event.metaKey) && event.key === 'r') {
                        event.preventDefault();
                        this.scanForReports();
                    }

                    // Esc to close admin panel
                    if (event.key === 'Escape') {
                        document.getElementById('admin-panel').classList.remove('active');
                    }
                });
            }
        }

        // ============================
        // INITIALIZATION
        // ============================
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new DashboardCore();
            window.dashboard.initialize();

            // Listen for report ready events
            document.addEventListener('reportReady', (event) => {
                console.log('ðŸ“¬ Received reportReady event:', event.detail);
                // The report is already loaded via script tags, so we just need to refresh the view
                window.dashboard.updateStatistics();
                window.dashboard.renderDashboard();
            });

            // Auto-refresh every 2 minutes
            setInterval(() => {
                if (window.dashboard && window.dashboard.initialized) {
                    window.dashboard.scanForReports();
                }
            }, 2 * 60 * 1000);
        });
    </script>
</body>

</html>